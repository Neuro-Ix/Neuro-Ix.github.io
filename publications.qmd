---
title: "Publications"
listing:
  contents: posts # Directory containing the posts
  sort: 
    - "date desc"
    - "title desc"
  type: default #Three kinds of display : Default, table or grid
  categories: true #Enable categories
  sort-ui: true #Enable sorting bar
  filter-ui: false
  feed: true
  date-format: "YYYY-MM-DD"
  
toc: false
toc-location: body
page-layout: full
title-block-banner: false

engine: knitr
---


```{r}
#| include: false
#| warning: false
  
library(conflicted) #Solve conflicts
library(tidyverse)
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")

library(httr)

library("XML")
library("methods")

# Make a research on PubMed using Entrez API
url_research <- "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&reldate=10&term=Bouix[Author]&usehistory=y"

# Extract Query key and WebEnv of the previous research
raw_research <- httr::GET(url_research) %>% httr::content()

parsed_research <- xmlParse(file = raw_research)
list_research <- xmlToList(parsed_research)
qk <- toString(list_research[4])
we <- toString(list_research[5])

# Fetch data from PubMed using Entrez API and previous research
url <-paste("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&rettype=medline&retmode=text&usehistory=y&query_key=",qk,"&WebEnv=",we, sep = "")

raw <- httr::GET(url) %>% httr::content()
cat(raw)

# Analyse the raw data
# raw_list <- strsplit(raw,split='\n')
# 
# labels <- list() #list of the labels
# data <- list() #list of the data
# counter = 0
# for (i in raw_list){
#   ifelse(grepl("-", i, fixed = TRUE),next,next)#if there is a '-', the line is a new dataline
#   counter=counter+1
#   elements <- strsplit(raw,split=' - ')
#   labels <- append(labels,elements[1])
#   data <- append(data,elements[2])
# }
# df <- data.frame(labels,data)
# print(df)
# for (i in raw_list){
#   ifelse(nchar(i)<=1,print('aa'),print('bb'))
# }
# print(raw_list)
```